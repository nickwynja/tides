<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒŠ</text></svg>">

<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="/manifest.json">


{{ turbo() }}

<style>

body {
    font-family: monospace;
}

td {
    padding: 0 5px 5px 5px;
}

form,
form select,
form input {
    font-size: 16px;
}

form.flex {
    display: flex;
    flex-wrap: wrap;
}

form .row {
    padding-left: 10px;
    padding-bottom: 5px;
}

select {
    max-width: 95%;
}

#offset {
    width: 4ch;
}

#map {
    max-width: 100%;
}

</style>

<title>Tides</title>
</head>

<body>

<form action="/" method="POST" class="flex">
    <div class="row">
        <label for="tide">Tide station:</label>
        <select name="tide" id="tide">
            {% for s in local_tide_stations | sort(attribute='name') %}
            <option value="{{s.id}}" {{'selected' if tide_station['id'] == s['id']}} >{{ s.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="row">
      <label for="current">Current station:</label>
      <select name="current" id="current">
          {% for s in local_current_stations | selectattr("currbin", "equalto", 1) | sort(attribute='name') %}
          <option value="{{s.id}}" {{'selected' if current_station['id'] == s['id']}} >{{ s.name }}</option>
          {% endfor %}
      </select>
    </div>
    <div class="row">
      <label for="met">Met:</label>
      <select name="met" id="met">
          {% for s in local_met_stations | sort(attribute='name') %}
          <option value="{{s.id}}" {{'selected' if met_station['id'] == s['id']}} >{{ s.name }}</option>
          {% endfor %}
      </select>
    </div>
    <div class="row">
      <label for="offset">+/-</label>
      <input type="number" name="offset" id="offset"/>
      {% if tide_offset != 0 %}
      <span>{{ "+" if tide_offset > 0 else ""}}{{ tide_offset }}min</span>
      {% endif %}
    </div>
    <div class="row">
      <input type="submit" value="Submit">
    </div>
</form>

{{ fig_html | safe }}

<details>
    <summary>Today's text report</summary>
    <br>
    <table>
        {% for t in text_report %}
        <tr>
            <td>{{ t.time.strftime('%H:%M')}}</td>
            <td>{{ t.text}}</td>
        </tr>
        {% endfor %}
    </table>
</details>


<h3>WX</h3>

<p><a href="https://marine.weather.gov/MapClick.php?lat={{ current_station['lat'] }}&lon={{ current_station['lng'] }}">Marine Forecast</a></p>

<table>
    {% for f in forecast %}
    <tr>
        <td>{{ f.when}}</td>
        <td>{{ f.text}}</td>
    </tr>
    {% endfor %}
</table>

<h3>Observations</h3>

<table>
    <tr>
        <td>Station:</td>
        <td><a href="https://tidesandcurrents.noaa.gov/stationhome.html?id={{ met_station['id'] }}">{{ met_station['name'] }}</a></td>
    </tr>
    <tr>
        <td>Water temp:</td>
        <td>{{ water_temp['v'] }}&deg;F</td>
    </tr>
    <tr>
        <td>Updated at:</td>
        <td>{{ water_temp['t'] }}</td>
    </tr>
</table>

<h3>Station Details</h3>

{% set tc = tide_station['lng']|string + "," + tide_station['lat']|string %}
{% set cc = current_station['lng']|string + "," + current_station['lat']|string %}
{% set at = "pk.eyJ1Ijoibmlja3d5bmphIiwiYSI6ImNtMzh6ZWN0YzBrbXUybG9nYXhjdnFlc2cifQ.uUURdxJOZ72zXmM9oqvW7g" %}

<img id="map" src="https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v12/static/pin-s+1e00ff({{tc}}),pin-s+ff0000({{cc}})/auto/600x400?padding=50&access_token={{at}}" />

<table>
    <tr>
        <td>Tide:</td>
        <td><a href="https://tidesandcurrents.noaa.gov/stationhome.html?id={{ tide_station['id'] }}"</a>{{ tide_station['name'] }}</td>
    </tr>
    <tr>
        <td></td>
        <td><a href="https://tidesandcurrents.noaa.gov/map/index.html?lat={{ tide_station['lat'] }}&lng={{ tide_station['lng'] }}&zoom=11&type=tidepredictions&id={{ tide_station['id'] }}">View on map</td>
    </tr>
    <tr>
        <td></td>
        <td>{{ tide_station['lat'] }}, {{ tide_station['lng'] }}</td>
    </tr>
    <tr>
        <td>Current:</td>
        <td><a href="https://tidesandcurrents.noaa.gov/noaacurrents/predictions.html?id={{ current_station['id'] }}_1"</a>{{ current_station['name'] }}</td>
    </tr>
    <tr>
        <td></td>
        <td>{{ current_station['lat'] }}, {{ current_station['lng'] }}</td>
    </tr>
    <tr>
        <td></td>
        <td><a href="https://tidesandcurrents.noaa.gov/map/index.html?lat={{ current_station['lat'] }}&lng={{ current_station['lng'] }}&zoom=11&type=currentpredictions&id={{ current_station['id'] }}">View on map</td>
    </tr>
</table>

<!-- https://sunrise-sunset.org/api -->
</body>
</html>
